#include "signer.h"
#include "mbedtls/pk.h"
#include <time.h>

// The private key context that will be used for the entire encryption
mbedtls_pk_context privateKey;

#define PRIVATE_KEY_BUFFER_LEN 1676
const unsigned char keyBuffer[PRIVATE_KEY_BUFFER_LEN] = {
     '-', '-', '-', '-', '-', 'B', 'E', 'G', 'I', 'N', ' ', 'R', 'S', 'A', ' ', 'P', 'R', 'I', 'V', 'A', 'T', 'E', ' ', 'K', 'E', 'Y', '-', '-', '-', '-', '-', '\n',
     'M', 'I', 'I', 'E', 'o', 'g', 'I', 'B', 'A', 'A', 'K', 'C', 'A', 'Q', 'E', 'A', 'k', 'A', 'Z', 'G', 'j', '3', 'i', '9', 'u', 'G', 'Y', '+', 'O', '8', 'W', 'O', 'T', 'b', 'm', 'Z', 'v', 'z', 'L', 'J', 't', '+', 'a', 'o', '9', '5', '7', 'P', 'n', 'w', 's', '4', 'z', 'B', '2', 'E', 'h', 'T', '3', '3', '1', 'r', '/', 'a', '\n',
     'A', 'A', 'P', 'j', 'I', 'C', 'P', 'W', 'f', 'n', 'H', 'Q', 'n', 'j', 'u', 'x', '0', 'k', 'M', 'B', 'z', 'X', 'X', 'F', 'C', '1', 'k', 'Q', 'O', 'p', 'J', 'Q', '7', 'v', 'n', 'I', 'R', 'S', 'L', 'a', 'p', 'J', 'l', 'h', '/', 'H', '+', '1', 'w', 'V', '2', 'G', 'd', 'n', '+', 'A', 'w', 'x', 'C', 'V', 'X', 'K', 'w', 'T', '\n',
     'm', 's', 'h', 'O', 'A', 'S', 'P', 'Z', 'r', 'y', 'o', '7', '+', 'P', 'L', '+', 'Q', '3', '+', 'G', 'I', 'R', '7', 'L', 'j', 'O', 'G', 'q', 'B', 'b', 'Z', 'n', '6', 'L', 'U', 'w', 'W', 'A', 'A', 'W', '1', '8', '6', 'c', 'm', '+', 'z', 'y', '4', 'p', 'A', 'W', 'r', '0', 'P', 'F', 'Y', '+', 'R', 'A', 'e', 'g', 'V', 'V', '\n',
     'x', 'm', 'B', 'i', 'j', 'Y', '2', 'U', 'H', 'r', '9', '4', 'w', 'C', 'T', 'L', 'v', 'T', 'x', 'Q', 'l', 'J', 'G', '4', '0', '7', 't', '5', 'k', 'h', 'm', '+', 'p', 'J', 'd', 'i', 'w', 'c', 'X', 'A', '0', 'b', '1', 'D', 'T', 'a', 'B', 'U', 'j', 'c', 'U', 'B', 'n', 'c', 'b', 'u', 'e', 'b', 'I', '4', 'V', 'B', 'K', 'i', '\n',
     '6', 'h', '6', 'a', 'l', 'f', 'm', 'Z', 'M', 'j', '6', 'i', 'y', 'd', 'o', 'O', 'u', '0', 'I', 'v', 'h', 'x', 'P', 'o', 'i', 'k', 'I', '6', 'm', 'Y', 'R', 'p', 'm', 'm', 'S', 'I', 'Q', 'z', 'j', 'y', 'v', '1', 'e', 'M', 'G', 'B', 'R', 'i', 'i', 'O', 'i', 'n', '4', 'B', 'u', '4', 'i', 'R', 'r', 'b', 'Z', '9', 'z', '9', '\n',
     'R', '7', 'z', 'j', 'Z', 'X', 'v', '4', '5', 'F', 't', 'L', 'D', 'p', 'K', 'Z', 'f', 'z', 'W', 'J', 't', 'A', 'i', 'q', 'b', '4', 'G', 'V', 'h', 'F', '1', 'd', 'o', 'R', 'y', '7', 't', 'Q', 'I', 'B', 'J', 'Q', 'K', 'C', 'A', 'Q', 'A', '+', 'R', '+', 'c', 'p', 'S', 'P', 'g', 'Y', 'Y', '5', 'C', 'I', 'j', 'M', 'f', 'q', '\n',
     'Q', 'm', 'v', '/', 'p', '0', 'J', '5', 'C', 'c', 'y', 'G', 'w', 'T', 'c', 'w', 'B', 'N', 'p', 'K', 'b', 'a', 'E', 'X', 'B', 'g', 'p', 'P', 'B', 't', 'r', 'P', 'k', 'v', 'p', 'u', 'w', '2', 'O', 's', 'T', 'O', 'S', 'X', 'c', '8', 'K', 'E', 'c', 'A', 'D', 'H', 'j', 'N', '+', 'W', 'N', 'F', 'o', 'L', 'f', 'Y', 'r', 'I', '\n',
     'N', 'K', 'm', 'h', 'W', 'y', '4', 'd', 'q', 'h', 'y', 'I', '3', 'U', 'e', 't', 'k', 'D', 'o', 'l', 'Z', '5', 'G', 'g', 'd', 'd', '+', '5', 'X', 'y', 's', 'S', 'g', 'C', 'G', '7', 'T', 'c', 'X', 'q', '4', 'd', 'S', '+', 'r', 'k', 'R', 'w', 'N', 'y', 'U', '+', 'w', 'T', 'V', 't', 'W', 'q', 'p', 'j', 'V', 'c', 'w', 'R', '\n',
     'm', 'n', 'X', 'F', 'M', 'H', 'i', 'U', 'r', 'F', '9', 'm', 'B', 'Z', 'l', '2', 'u', 't', 'l', 'g', 'j', 'A', 'J', 'U', 't', 'Q', '/', 'u', 'x', 'T', 'F', 'Z', 't', 'A', 'L', 'u', 'i', 'E', 'c', 'q', '5', 'o', 'Q', 'z', '8', 'W', 'o', 'E', '7', '1', 'x', 'w', 'K', 'Y', 'S', 'd', 'z', 'D', 'Y', 'B', 'T', 'p', 'l', 'S', '\n',
     'r', '1', 'M', 'i', 'F', '4', 'r', 'x', 'c', '0', 'X', 'O', 'p', 'y', 'a', 'X', 'S', 'k', 'Z', 'B', 'I', 'M', '9', 'Y', 'O', '+', '4', 'J', 'p', 'a', 'g', 'A', 'o', '5', '1', 'X', 'j', 's', 'S', 'i', '/', 'Z', 'q', 'g', '4', 'y', 'Q', 'l', 'L', 'f', '8', 'A', 'R', '1', 'o', 'o', 'n', 'z', '+', '1', 'U', 'O', 'v', 'C', '\n',
     'a', 'm', 'o', 'F', 't', 'z', '6', 'B', '9', 'W', 'v', 'k', 's', 'R', 'b', 'A', 'o', 'G', 'q', 'h', '9', 'P', 's', 'Z', 'z', 'c', 'V', 'H', 'Z', 'r', '9', 'a', '3', 'M', '2', 'H', 'k', 'b', 'j', 'A', 'c', 'f', 'q', 'h', 'j', 'Q', 'O', 'S', 'b', 'R', 'n', 't', 'M', 'C', 'Z', '9', 'H', 'V', 'F', 'o', 'u', '1', 'N', 'P', '\n',
     'e', 'V', '9', 't', 'A', 'o', 'G', 'B', 'A', 'P', 'V', 'd', 'l', '3', 'z', 'r', '5', 'i', 'z', 'I', 'K', 'n', 'l', 'Z', '1', 'N', '0', 'M', '/', 'U', 'A', '6', 't', 'r', '4', 'C', '7', 'S', 'a', 'w', 'K', 'X', '4', 'Z', 'W', '8', 'G', 'C', 'o', '4', 'F', '+', 'i', '9', '8', 'u', '8', 't', '8', 'H', 'k', 'D', '2', 'N', '\n',
     'O', 'I', 'm', 'N', 'n', 'h', 'I', 'q', '/', 'l', 'U', 's', 'K', 'F', 's', '7', 'f', 'l', 'k', 'C', 'v', '9', 'g', 'x', 'j', 'h', '4', 'c', 'v', 'X', 'x', 'e', 'I', 'g', 'X', 'J', 'n', 'D', '/', 'K', '7', 'b', 'K', 'w', 'J', 'F', 'r', 'w', 's', 'k', 'i', 'w', 't', 'E', 'R', 'y', 'H', '8', 's', 'G', 'Y', 'A', 'k', '0', '\n',
     'W', 'L', 'F', '6', 'F', 'Y', '+', 'k', 'I', '/', 'c', 'C', '+', 'R', 'W', 'r', 'M', 'T', '5', 'D', '/', 'h', 'j', 'S', 'v', '3', 'a', '8', 'K', 'V', 'z', 's', 'H', 'r', 'r', '+', 'h', '4', 'g', 'D', 'K', 'N', 'C', 'R', 'n', 'T', '9', 'w', 'e', 'C', 'q', '7', 'A', 'o', 'G', 'B', 'A', 'J', 'Z', 'E', 'R', 'd', 'a', '7', '\n',
     'C', 'e', '7', '9', 'x', '/', 'Y', 'x', 't', 'Y', 'n', '7', 'C', 'U', 'Z', 'X', 'H', 'A', 'z', 'O', 'R', 'I', '9', '2', 'q', 'b', '6', 'V', 'u', 'D', 'q', 'S', 'v', 'n', 'E', 'E', 'Y', '3', 'B', 'U', 'b', '9', 'L', 'Y', 'L', 'Y', '3', 'C', 's', 'L', 'W', 'Z', 'j', 'P', 'z', 'S', 'q', 'U', 'y', 'x', 'm', 'z', 'M', 't', '\n',
     'J', 'e', 'W', '4', 'v', '5', 'p', 'H', 'x', 'g', '8', 'Z', 'D', '0', '7', 'H', 'J', 'c', 'w', 'M', '0', 'q', 'h', 'B', 'Z', 'E', 'S', 'W', 'F', 'O', '1', '4', 'H', 'C', 'p', 'l', 'T', 'O', '3', 'A', 's', 'D', 'e', 'Q', '2', 't', 'S', '3', 'H', 'P', '/', 'P', 'f', '6', 'Q', '5', 'S', 'w', 'w', 'v', 'x', 'k', '0', 'a', '\n',
     'b', 'Q', 'n', 'X', '/', 'O', 'T', 'U', 'l', 'E', 'C', '8', '0', 'y', 'R', 'Q', 'e', 'o', 'L', 'B', 'A', 'c', 'l', 'r', 'B', 'P', 'i', 'w', 'j', 'u', '2', 'I', '2', '+', 'R', 'P', 'A', 'o', 'G', 'A', 'a', 'h', 'q', 'i', 'X', '4', 'i', 'a', '4', 'u', '7', 'G', 'Q', 'l', 'B', 'c', 'D', 'I', '/', '+', 'z', '6', 'q', 'v', '\n',      '4', '3', 'b', 'j', 'F', '6', 'Y', 'f', 'x', '9', 'O', 'd', 'T', 'M', 'L', 'e', '6', '+', 'O', 'y', 'G', '1', 'K', 'S', 'i', 'f', 'V', 'u', 'z', 'o', 'J', 'B', '9', 'k', 's', 'T', '7', 'C', '5', 'E', 'd', '9', 'u', '+', 'b', 'K', 'Q', 'a', '9', 'g', '8', 'G', '2', 'g', 'e', 'X', 'Z', 'v', 'e', 'r', '4', 's', 'D', 's', '\n', \
     'H', 'i', '2', 'r', 'W', 'd', 's', '2', 'W', 'x', 'u', '8', 's', 'b', 'Q', 'x', 'a', '4', 'q', 'u', '0', 'X', '1', '1', 'i', 'D', 'o', 'b', 's', 'P', 'Q', 'K', 'r', 'Z', 'y', 'T', 's', '7', 'y', 'Z', '7', 'k', 'Z', '5', 'j', 'N', 'R', 'o', 'U', 'k', 'b', 'q', 'a', '5', 'l', 'n', 'j', 'U', 'p', 'y', 'w', 'G', 'Y', 'b', '\n',
     'I', 'G', '4', 'R', 'G', 'D', 'i', '3', 't', 'C', 'N', 'K', '6', 'w', 'A', 'z', '9', 's', '0', 'C', 'g', 'Y', 'E', 'A', 'k', 'j', 'S', 'W', '+', 'n', 'D', 'L', 'Z', 'R', 'K', 'Z', 'C', 'z', 'd', 'I', '2', 'U', 'd', 'H', 'S', '1', 'u', 's', 'l', 't', 'a', 'H', '5', 'Y', 'g', '2', 'd', 'D', '6', 'l', 'a', 'W', 'w', 'u', '\n',
     '6', 'o', 'D', 'P', 'd', 'D', 'Z', '6', 'o', '6', 'H', 'n', 'I', 'i', 'U', '2', 'T', '9', 'O', 'r', 'x', 'Y', '6', 'y', 'j', '8', '9', 'm', 'k', 'q', 'h', '3', '5', 'm', '6', 'Q', '6', 'S', 'M', '9', 'P', 'x', '9', 'N', 'K', 'g', '3', 'f', 'l', 'h', 'p', 'Q', 'b', 'F', 't', 'M', 'z', 'R', 'x', 'n', 'Y', '5', 'd', '1', '\n',
     'W', 'a', '6', 'r', 't', 'u', 'T', '+', 'e', '0', 'D', 'U', '6', 'q', 'R', 'T', 'k', 'R', 'z', 'q', '5', 'P', 'l', '5', 'c', '6', 'Q', 'a', '4', 'z', 'x', 'O', 'a', 'n', 'F', 'J', 'F', 'f', '9', 'E', 'I', '0', '/', 'w', 'B', '6', 'g', '/', '2', 'S', 'p', '+', 'R', '2', '8', 'L', 'w', 'Y', 'k', 'x', 'H', 'n', 'd', 'S', '\n',
     'f', 'U', 'U', 'C', 'g', 'Y', 'E', 'A', 'i', '+', 'Y', 'l', 'U', '/', 's', '8', 'G', '2', 'J', 'G', '5', '+', 'F', 'o', 'h', 'a', 's', 'y', 'G', 'v', 'p', 'U', 'H', 'M', 'g', 'A', 'B', '6', 'Y', '/', 'L', 'u', 'H', 'u', '8', 'X', 't', 'O', 'l', 'g', 'h', '2', 'R', 'Y', 'S', 'r', '/', 'a', '5', 'l', '0', 'g', 'd', 'x', '\n',
     'o', 'U', 'r', '6', 'X', 'w', 'D', 'J', 'c', 'k', 'G', 'M', 'p', 'v', '0', 'S', 'E', 'P', 'o', 'v', 'c', 'W', 'q', '9', 'y', '+', 'i', '0', 'F', 'S', 'g', 'P', 'W', 'o', 'S', 'l', '9', 'K', 'W', 'H', '/', 'H', '+', 'p', 'f', '6', 'F', 'D', '9', 'N', 'M', 'p', '5', 'J', '9', '/', '5', 'z', 'J', '2', 'o', 'f', 'S', 'o', '\n',
     'b', 'G', 'E', '4', 'y', 'M', 'V', 'H', 'f', 'L', 'o', '6', 'b', 'J', 'e', 'V', 'K', 'd', 'z', 'X', '3', 'g', 'h', 'W', 'U', 's', '6', '1', 'T', 'I', 'D', 'M', '2', 'z', 'q', 'Y', '0', 'a', 'e', 'H', '8', 'm', 'd', '+', 'T', 'L', 'Y', 'n', '0', 'l', 'g', '=', '\n',
     '-', '-', '-', '-', '-', 'E', 'N', 'D', ' ', 'R', 'S', 'A', ' ', 'P', 'R', 'I', 'V', 'A', 'T', 'E', ' ', 'K', 'E', 'Y', '-', '-', '-', '-', '-', '\n', 0x00
};

void RSA_init() {
    int pk_error;

    // Initialize the private key state
    mbedtls_pk_init(&privateKey);

    pk_error = mbedtls_pk_parse_key(&privateKey, keyBuffer, PRIVATE_KEY_BUFFER_LEN, NULL, 0);
    if (pk_error != 0) {
        // Well this means loading the key failed. this sucks
        // TODO: figure out what to do from here, maybe we can notify the failure via BLE
    }
    else {
        // Key loading worked!

    }

    return;
}
